rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // ⚠️ REGRAS TEMPORÁRIAS PARA DESENVOLVIMENTO
    // ⚠️ ATENÇÃO: Estas regras permitem uploads SEM autenticação
    // ⚠️ ALTERE PARA PRODUÇÃO antes de fazer deploy!
    
    // ============================================
    // ESTRUTURA PADRONIZADA: advertisements/{anuncioId}/
    // ============================================
    // Todas as páginas de cadastro agora usam esta estrutura:
    // - advertisements/{anuncioId}/banner/
    // - advertisements/{anuncioId}/galeria/
    // - advertisements/{anuncioId}/upload_doc/ (documentos de verificação)
    
    // Regras para arquivos de anúncios públicos (pasta advertisements/)
    match /advertisements/{anuncioId}/{allPaths=**} {
      // Permitir leitura pública para imagens de anúncios
      allow read: if true;
      // ⚠️ TEMPORÁRIO: Permitir escrita sem autenticação (apenas para desenvolvimento)
      // Para produção, altere para: allow write: if request.auth != null;
      allow write: if true;
    }
    
    // Regras para documentos privados de verificação (dentro de advertisements/)
    match /advertisements/{anuncioId}/upload_doc/{allPaths=**} {
      // ⚠️ TEMPORÁRIO: Permitir escrita sem autenticação (apenas para desenvolvimento)
      // Para produção, altere para: allow read, write: if request.auth != null;
      allow read, write: if true;
    }
    
    // Regras para arquivos de anúncios públicos (pasta ads/ - compatibilidade)
    match /ads/{userId}/{adId}/{allPaths=**} {
      // Usuário autenticado pode ler
      allow read: if request.auth != null;
      // Apenas o dono do anúncio pode escrever
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Regras para documentos privados de verificação (pasta private/ - compatibilidade)
    match /private/{userId}/{adId}/{allPaths=**} {
      // Apenas o dono pode ler/escrever
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Regra padrão: negar tudo
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}





